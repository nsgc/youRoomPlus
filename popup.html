<!DOCTYPE html><html>  <head>    <title>youRoomPlus</title>    <link type="text/css" href="jquery-ui-1.8.11.custom/css/ui-lightness/jquery-ui-1.8.11.custom.css" rel="Stylesheet"/>    <link type="text/css" href="base.css" rel="Stylesheet"/>    <script type="text/javascript" src="jquery-ui-1.8.11.custom/js/jquery-1.5.1.min.js"></script>    <script type="text/javascript" src="jquery-ui-1.8.11.custom/js/jquery-ui-1.8.11.custom.min.js"></script>    <script type="text/javascript" src="jquery.tmpl.min.js"></script>    <script type="text/javascript" src="date.js"></script>    <script id="showEntryTemplate" type="text/x-jquery-tmpl">      <dt>${entry.participation.name}(${dateFormat(entry.updated_at)})</dt>      <dd>	<section>	  <p>${entry.content}</p>	  <p class='toggleEntryArea' id='toggleEntryArea${entry.id}'>entry comment</p>	  <footer style='display:none' id='footer${entry.id}'>	    <textarea id='textArea${entry.id}'></textarea>	    <button class='post' id='post${entry.id}'>post</button>	  </footer>	</section>	{{html showNestedComments(entry)}}      </dd>    </script>    <script id="homeTimeLineTemplate" type="text/x-jquery-tmpl">      <dt>${entry.participation.name}@${entry.participation.group.name}(${dateFormat(entry.updated_at)})</dt>      <dd>${entry.content}	<p onclick=getEntryFromHome('${entry.participation.group.to_param}','${entry.id}')>detail</p>      </dd>    </script>    <script id="roomTimeLineTemplate" type="text/x-jquery-tmpl">      <dt>${entry.participation.name}(${dateFormat(entry.updated_at)})</dt>      <dd>${entry.content}	<p onclick=getEntryFromRoom('${entry.id}')>detail</p>      </dd>    </script>    <script id="groupOptionsTemplate" type="text/x-jquery-tmpl">      <option value=${group.id}>${group.name.substring(0, 10)}</option>    </script>    <script type="text/javascript">      $(function() {       var $tabs = $("#tabs").tabs();        $("#selectRoom").change(function () {          $("#homeTL").empty();          loadTimeLine($(this).val());          $tabs.tabs('select', 1); // switch to second tab          return false;        });        $("#selectRoom").focus(function () {          $("#homeTL").empty();          loadTimeLine($(this).val());          $tabs.tabs('select', 1); // switch to second tab          return false;        });        $("#home").click(function () {          $("#roomTL").empty();          loadTimeLine("all");          return false;        });      });      var bgPage = chrome.extension.getBackgroundPage();      var depth = 0;      function showNestedComments(obj){        var comment = "";        if (obj.children == null) {          return "";        } else {          depth += 1;          jQuery.each(obj.children, function(){            comment = comment.concat("<dl class='child'><dt class='depth_level", depth, "'>", this.participation.name,"(", dateFormat(this.updated_at), ")</dt><dd class='depth_level", depth, "'><section><p>", this.content, "</p><p class='toggleEntryArea' id='toggleEntryArea", this.id, "'>entry comment</p><footer style='display:none' id='footer", this.id, "'><textarea id='textArea", this.id, "'></textarea><button class='post' id='post", this.id, "'>post</button></footer></section>", showNestedComments(this), "</dd></dl>");          });          depth -= 1;          return comment;        }      };      function whichSelectTabs() {        if ($("li.ui-tabs-selected").children()[0].toString().indexOf("#tab_home") > 0) {          return "home";        } else if ($("li.ui-tabs-selected").children()[0].toString().indexOf("#tab_room") > 0) {          return "room";        }      };      function callbackPostEntry(resp, xhr){        var data = JSON.parse(resp);        switch ( whichSelectTabs() ){          case "home":            getEntryFromHome(data.entry.participation.group.to_param, data.entry.root_id);            break;          case "room":            getEntryFromRoom(data.entry.root_id);            break;        }      };      function postEntry(target_id, target_textArea, target_group){        var url = 'https://www.youroom.in/r/' + target_group + "/entries";        var request = { 'method': 'POST', 'parameters': {'format': 'json', 'entry[content]':  target_textArea , 'entry[parent_id]' : target_id}, 'headers': { 'Content-Type': 'application/xml'} };        bgPage.oauth.sendSignedRequest(url, callbackPostEntry, request);      };      function toggleTextArea(target_id){        $("#footer"+target_id).toggle("blind",{} ,0 );      };      var callbackShowEntryFromHome = function(resp, xhr) {        var data = JSON.parse(resp);        $("#homeTL").empty();        $("#showEntryTemplate").tmpl(data).appendTo("#homeTL");        $("p.toggleEntryArea").click(function () {          toggleTextArea(this.id.slice("toggleEntryArea".length));          return false;        });        $("button.post").click(function () {          postEntry(this.id.slice("post".length), $("#textArea" + this.id.slice("post".length)).val(), $('#selectRoom option:selected').val());          return false;        });      };      var getEntryFromHome = function(group_param, id){        var url = "https://www.youroom.in/r/" + group_param + "/entries/" + id;        var request = { 'method': 'GET', 'parameters': {'format': 'json'} };        bgPage.oauth.sendSignedRequest(url, callbackShowEntryFromHome, request);      };      var callbackShowEntryFromRoom = function(resp, xhr) {        var data = JSON.parse(resp);        $("#roomTL").empty();        $("#showEntryTemplate").tmpl(data).appendTo("#roomTL");        $("p.toggleEntryArea").click(function () {          toggleTextArea(this.id.slice("toggleEntryArea".length));          return false;        });        $("button.post").click(function () {          postEntry(this.id.slice("post".length), $("#textArea" + this.id.slice("post".length)).val(), $('#selectRoom option:selected').val());          return false;        });      };      var getEntryFromRoom = function(id){        var url = "https://www.youroom.in/r/" + $('#selectRoom option:selected').val() + "/entries/" + id;        var request = { 'method': 'GET', 'parameters': {'format': 'json'} };        bgPage.oauth.sendSignedRequest(url, callbackShowEntryFromRoom, request);      };      var callbackMyGroups = function(resp, xhr) {        var data = JSON.parse(resp);        $("#selectRoom").empty();        $("#groupOptionsTemplate").tmpl(data).appendTo("#selectRoom");      };      var loadMyGroups = function() {        var url = 'https://www.youroom.in/groups/my';        var request = { 'method': 'GET', 'parameters': {'format': 'json'} };        bgPage.oauth.sendSignedRequest(url, callbackMyGroups, request);      };      var callbackHomeTimeLine = function(resp, xhr) {        var data = JSON.parse(resp);        if(window.webkitNotifications.checkPermission() !== 0){          $("#block").html("<p class='message' onclick='permissionNotification();'>デスクトップ通知を許可</p>");        }        $("#homeTL").empty();        $("#homeTimeLineTemplate").tmpl(data).appendTo("#homeTL");      };      var callbackRoomTimeLine = function(resp, xhr) {        var data = JSON.parse(resp);        $("#roomTL").empty();        $("#roomTimeLineTemplate").tmpl(data).appendTo("#roomTL");      };      var loadTimeLine = function(target) {        var url = 'https://www.youroom.in/';        var request = { 'method': 'GET', 'parameters': {'format': 'json'} };        if (target == "all" ) {          bgPage.oauth.sendSignedRequest(url, callbackHomeTimeLine, request);        } else {          bgPage.oauth.sendSignedRequest((url + "r/" + target), callbackRoomTimeLine, request);        }      };      function permissionNotification() {        window.webkitNotifications.requestPermission();        window.close();      };      bgPage.oauth.authorize(loadMyGroups);      loadTimeLine("all");    </script>  </head>  <body>    <div id="tabs">      <div id="block">      </div>      <ul>	<li><a href="#tab_home" id="home">HOME</a></li>	<li><a href="#tab_room"><select id="selectRoom"></select></a></li>      </ul>      <div id="tab_home">	<dl id="homeTL">	</dl>      </div>      <div id="tab_room">	<dl id="roomTL">	</dl>      </div>    </div>  </body></html>